# GameMacro - 游戏操作录制与自动化工具

## 1. 产品概述

GameMacro是一款运行在Windows系统上的工具，能够录制、编辑和回放用户在游戏中的鼠标和键盘操作，用于自动化重复性游戏任务。该工具保持在所有窗口最上层显示，最小化后可选择是否显示悬浮图标，提供直观的用户界面以实现游戏操作的录制、编辑和回放。

## 2. 核心功能需求

### 2.1 界面与交互

1. **界面层级**
   - 保持在所有窗口最上层显示
   - 支持点击穿透模式（可配置）
   - 提供置顶/取消置顶按钮

2. **最小化行为**
   - 支持最小化到系统托盘
   - 可配置是否显示悬浮图标
   - 悬浮图标支持拖动位置

3. **界面布局**
   - 主界面包含录制控制区、操作列表区和操作编辑区
   - 提供紧凑模式和展开模式
   - 支持界面主题切换（明/暗主题）

### 2.2 操作录制功能

1. **输入捕获**
   - 捕获键盘按键事件(按下/释放)及持续时间
   - 捕获鼠标事件(移动/点击/滚轮)及坐标信息
   - 支持绝对坐标和相对坐标模式
   - 支持特定窗口内的坐标记录

2. **录制控制**
   - 开始/暂停/停止录制功能
   - 支持快捷键触发录制操作
   - 录制过程中显示实时反馈
   - 支持设置录制延迟

3. **操作识别**
   - 智能识别连续的鼠标移动为单一操作
   - 识别组合键操作
   - 支持按住不放的持续操作记录

### 2.3 操作编辑功能

1. **操作列表管理**
   - 以列表形式显示所有录制的操作
   - 支持操作的启用/禁用
   - 支持操作的复制/粘贴/删除
   - 支持多选操作进行批量编辑

2. **操作属性编辑**
   - 修改操作的类型（键盘/鼠标）
   - 调整操作持续时间
   - 修改操作坐标（对于鼠标事件）
   - 修改按键代码（对于键盘事件）

3. **时间调整**
   - 修改操作之间的间隔时间
   - 支持插入等待时间
   - 支持等比例缩放所有时间间隔

4. **操作排序**
   - 拖拽重新排序操作
   - 支持操作分组
   - 支持嵌套操作序列

### 2.4 操作回放功能

1. **基本回放**
   - 按录制顺序回放操作序列
   - 支持回放速度调整（0.5x-2.0x）
   - 支持单步回放

2. **循环控制**
   - 支持设置循环次数
   - 支持无限循环
   - 支持循环间隔时间设置

3. **条件回放**
   - 支持设置开始回放的快捷键
   - 支持设置停止回放的快捷键
   - 支持设置暂停回放的条件（可选）

4. **模拟设置**
   - 可调整操作模拟的真实度（人性化程度）
   - 支持在鼠标移动中添加轻微随机性
   - 支持按键按下时间的轻微随机性

### 2.5 数据管理

1. **存储功能**
   - 保存/加载操作序列
   - 自动保存功能
   - 支持多个操作序列的管理

2. **导入导出**
   - 导出操作序列为JSON格式
   - 导入JSON格式的操作序列
   - 支持操作序列的分享

3. **模板管理**
   - 保存常用操作序列为模板
   - 模板分类管理
   - 快速应用模板

## 3. 非功能需求

### 3.1 性能需求

1. **响应性**
   - 录制和回放的延迟低于10ms
   - 界面操作响应时间低于100ms

2. **资源占用**
   - 内存占用不超过200MB
   - CPU使用率在录制/回放状态下不超过10%
   - 空闲状态下CPU使用率不超过1%

3. **启动性能**
   - 冷启动时间不超过3秒
   - 热启动时间不超过1秒

### 3.2 兼容性需求

1. **操作系统**
   - 支持Windows 10各版本（1809及以上）
   - 支持Windows 11各版本
   - 仅支持64位系统（不再支持32位系统）
   - 支持不同的Windows主题（明/暗模式）

2. **游戏兼容性**
   - 支持DirectX、OpenGL和Vulkan渲染的游戏
   - 支持全屏、窗口和无边框窗口模式游戏
   - 支持各种分辨率和刷新率设置
   - 支持多显示器环境

3. **硬件要求**
   - 最低配置：4GB RAM, 四核CPU, 支持.NET 8.0的系统
   - 推荐配置：8GB RAM, 六核或更高CPU
   - 支持高DPI显示器和触摸屏（可选）

### 3.3 安全需求

1. **系统安全**
   - 不修改游戏内存
   - 使用模拟真实输入的方式
   - 不触发常见的反作弊系统

2. **数据安全**
   - 本地存储用户数据
   - 不收集用户隐私信息
   - 提供数据备份和恢复功能

### 3.4 可用性需求

1. **易用性**
   - 直观的用户界面
   - 操作流程简单明了
   - 提供工具提示和上下文帮助

2. **辅助功能**
   - 支持键盘导航
   - 支持自定义快捷键
   - 支持高对比度模式

3. **错误处理**
   - 友好的错误提示
   - 自动恢复机制
   - 操作撤销/重做功能

## 4. 技术需求

### 4.1 技术栈

1. **开发语言和框架**
   - C# + WPF
   - .NET 8.0
   - 仅支持Windows平台

2. **UI框架**
   - HandyControl 3.5.1+
   - XAML 自定义控件
   - 支持资源字典和主题切换

3. **架构模式**
   - MVVM (Model-View-ViewModel)
   - 使用Prism 9.0+框架
   - 依赖注入和服务定位

4. **底层实现**
   - P/Invoke调用Windows Hook API
   - 使用Raw Input API捕获输入
   - SendInput API模拟输入
   - Windows消息处理

5. **数据处理**
   - Newtonsoft.Json 13.0+ 进行序列化
   - NLog 5.0+ 进行日志记录
   - 本地文件存储

### 4.2 开发环境

1. **IDE**
   - Visual Studio 2022（17.8及以上版本）
   - 建议安装XAML设计器和Blend组件

2. **版本控制**
   - Git
   - 使用GitHub Actions进行CI/CD

3. **依赖管理**
   - NuGet包管理
   - 固定版本号避免兼容性问题

4. **测试框架**
   - xUnit单元测试框架
   - Moq模拟框架
   - FluentAssertions断言库

## 5. 项目范围

### 5.1 包含内容

- 录制、编辑、回放功能的完整实现
- 现代化UI界面和用户交互体验
- 数据保存、加载和导出功能
- 系统托盘集成和快捷键支持
- 基本的错误处理和日志记录
- 多语言支持（初期支持中文和英文）
- 简单的自动更新功能

### 5.2 MVP（最小可行产品）功能

- 基本的键盘和鼠标操作录制
- 简单的回放功能（基本速度控制）
- 序列的保存和加载
- 简洁的UI界面
- 基本的系统托盘支持

### 5.3 后续迭代功能

- 高级编辑功能（操作分组、嵌套等）
- 人性化模拟设置（添加随机性）
- 条件触发和循环控制
- 模板库和分享功能
- 高级UI主题和自定义

### 5.4 不包含内容

- 游戏内画面识别和OCR功能（计划在未来版本中支持）
- 完整的脚本编程语言支持（基本的条件判断将支持）
- 网络同步和云存储功能
- 插件系统（计划在2.0版本中支持）
- 游戏内存修改功能（出于安全考虑不支持）

## 6. 交付物

- 可执行的应用程序（包含安装程序）
- 用户手册（HTML和PDF格式）
- 开发文档（包含架构设计和API文档）
- 源代码（含完整注释）
- 单元测试和集成测试套件
- 示例宏和模板
- 发布说明和已知问题列表

## 7. 开发计划

### 7.1 迭代周期

- 采用双周迭代开发模式
- 每次迭代结束进行内部评审
- 每月发布一次预览版本
- 每季度发布一次稳定版本

### 7.2 里程碑计划

1. **概念验证阶段（M1）**
   - 实现基本的输入捕获功能（键盘和鼠标钩子）
   - 实现基本的输入模拟功能（SendInput API）
   - 验证技术可行性和性能评估
   - 搭建基本项目结构和CI/CD流程

2. **核心功能开发（M2）**
   - 实现完整的录制功能（包括坐标模式选择）
   - 实现基本回放功能（支持速度调整）
   - 实现MVP版本的用户界面
   - 完成基本的数据模型和序列化

3. **扩展功能开发（M3）**
   - 实现高级编辑功能（分组、排序、时间调整）
   - 实现完整的数据管理（保存、加载、导出）
   - 实现系统托盘集成和快捷键支持
   - 增加基本的错误处理和日志记录

4. **优化与完善（M4）**
   - 性能优化（内存使用和CPU占用）
   - 用户体验改进（UI响应性和交互流程）
   - 兼容性测试（不同Windows版本和游戏）
   - 实现多语言支持和主题切换

5. **发布准备（M5）**
   - 文档完善（用户手册和开发文档）
   - 全面测试（功能、性能、兼容性）
   - 打包和安装程序制作
   - 准备发布渠道和支持计划

### 7.3 后续版本规划

**v1.0**（基础版）：完成以上所有里程碑的功能

**v1.5**（增强版）：
- 添加条件触发和循环控制
- 改进人性化模拟设置
- 增加模板库和简单分享功能

**v2.0**（专业版）：
- 添加基本的脚本支持
- 实现插件系统
- 支持简单的图像识别功能
- 添加高级UI自定义选项 